<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公司分析结果</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        neutral: '#F5F7FA',
                        dark: '#1D2129',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .tab-active {
                @apply text-primary border-primary font-medium;
            }
            .tab-content-active {
                @apply block;
            }
            .card-shadow {
                @apply shadow-lg hover:shadow-xl transition-shadow duration-300;
            }
            .responsive-table {
                @apply overflow-x-auto;
            }
            .md-table {
                @apply w-full min-w-full border-collapse my-4;
            }
            .md-table th {
                @apply bg-gray-50 text-left py-3 px-4 border border-gray-200 font-semibold text-gray-700 whitespace-nowrap;
            }
            .md-table td {
                @apply py-3 px-4 border border-gray-200 text-gray-800;
                min-width: 100px; /* 设置最小宽度，避免列过窄 */
            }
            .md-table tr:nth-child(even) {
                @apply bg-gray-50;
            }
            .md-table tr:hover {
                @apply bg-gray-100;
            }

            /* 针对signal列单独扩大宽度（关键） */
                .tab-content .md-content table th:nth-child(29), /* 假设signal是第23列（根据实际列数调整） */
                .tab-content .md-content table td:nth-child(29) {
                  min-width: 500px; /* 强制signal列最小宽度（可按需调整，如600px） */
                  max-width: none; /* 取消最大宽度限制 */
                }
                .tab-content .md-content table th:nth-child(28), /* 假设signal是第23列（根据实际列数调整） */
                .tab-content .md-content table td:nth-child(28) {
                  min-width: 500px; /* 强制signal列最小宽度（可按需调整，如600px） */
                  max-width: none; /* 取消最大宽度限制 */
                }

                /* 表头样式优化（可选） */
                .tab-content .md-content th {
                  background-color: #f5f5f5; /* 表头灰色背景，区分内容区 */
                  font-weight: bold;
                }
        }
    </style>
</head>

<body class="font-inter bg-gray-50 text-dark">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 页面标题 -->
        <header class="mb-10 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.8rem)] font-bold text-dark mb-2">查询结果</h1>
            <div class="w-24 h-1 bg-primary mx-auto rounded-full"></div>
        </header>

        <!-- 公司基本情况 -->
        <div class="bg-white rounded-xl p-6 mb-8 card-shadow">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fa fa-building-o text-primary mr-2"></i>公司基本情况
            </h2>
            <div class="md-content" id="stock-summary">{{ stock_summary }}</div>
        </div>

        <!-- Tab导航 -->
        <div class="border-b border-gray-200 mb-6">
            <ul class="flex flex-wrap -mb-px" id="tabList" role="tablist">
                <li class="mr-2" role="presentation">
                    <button
                        class="inline-block p-4 border-b-2 border-transparent rounded-t-lg text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-active"
                        id="fundamental-tab"
                        data-tab="fundamental-analysis"
                        type="button"
                        role="tab"
                    >
                        <i class="fa fa-line-chart mr-1"></i>基本面分析
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button
                        class="inline-block p-4 border-b-2 border-transparent rounded-t-lg text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                        id="annual-tab"
                        data-tab="annual-report-analysis"
                        type="button"
                        role="tab"
                    >
                        <i class="fa fa-file-text-o mr-1"></i>年报分析
                    </button>
                </li>
                <li role="presentation">
                    <button
                        class="inline-block p-4 border-b-2 border-transparent rounded-t-lg text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                        id="sentiment-tab"
                        data-tab="sentiment-analysis"
                        type="button"
                        role="tab"
                    >
                        <i class="fa fa-smile-o mr-1"></i>情绪分析
                    </button>
                </li>
            </ul>
        </div>

        <!-- Tab内容区域 -->
        <div class="tab-content">
            <!-- 基本面分析 -->
            <div id="fundamental-analysis" class="tab-pane tab-content-active bg-white rounded-xl p-6 mb-8 card-shadow">
                <div class="md-content">{{ fundamental_analysis }}</div>
            </div>

            <!-- 年报分析 -->
            <div id="annual-report-analysis" class="tab-pane hidden bg-white rounded-xl p-6 mb-8 card-shadow">
                <div class="md-content">{{ annual_report_analysis }}</div>
            </div>

            <!-- 情绪分析 -->
            <div id="sentiment-analysis" class="tab-pane hidden bg-white rounded-xl p-6 mb-8 card-shadow">
                <div class="md-content">{{ sentiment_analysis }}</div>
            </div>
        </div>
    </div>

    <script>
        // 配置marked选项，增强表格解析
        marked.setOptions({
            breaks: true,
            gfm: true,
            smartypants: true,
            tables: true,  // 明确启用表格支持
            pedantic: false,
            sanitize: false
        });

        // 自定义表格渲染器，确保表格被正确包裹
        const renderer = new marked.Renderer();
        renderer.table = function(header, body) {
            return `<div class="responsive-table">
                        <table class="md-table">
                            ${header}
                            ${body}
                        </table>
                    </div>`;
        };

        // Tab切换功能
        document.addEventListener('DOMContentLoaded', function() {
            // 获取所有Tab按钮和内容
            const tabButtons = document.querySelectorAll('#tabList button');
            const tabPanes = document.querySelectorAll('.tab-pane');

            // 为每个Tab按钮添加点击事件
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // 移除所有Tab的激活状态
                    tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                    tabPanes.forEach(pane => {
                        pane.classList.add('hidden');
                        pane.classList.remove('tab-content-active');
                    });

                    // 激活当前Tab
                    button.classList.add('tab-active');
                    const targetTab = document.getElementById(button.dataset.tab);
                    targetTab.classList.remove('hidden');
                    targetTab.classList.add('tab-content-active');

                    // 平滑滚动到内容顶部
                    targetTab.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });

            // 渲染所有Markdown内容
            function renderMarkdown() {
                // 公司基本情况
                const stockSummaryElement = document.getElementById('stock-summary');
                if (stockSummaryElement && stockSummaryElement.textContent.trim()) {
                    stockSummaryElement.innerHTML = marked.parse(stockSummaryElement.textContent, { renderer: renderer });
                }

                // 基本面分析
                const fundamentalElement = document.querySelector('#fundamental-analysis .md-content');
                if (fundamentalElement && fundamentalElement.textContent.trim()) {
                    fundamentalElement.innerHTML = marked.parse(fundamentalElement.textContent, { renderer: renderer });
                }

                // 年报分析
                const annualReportElement = document.querySelector('#annual-report-analysis .md-content');
                if (annualReportElement && annualReportElement.textContent.trim()) {
                    annualReportElement.innerHTML = marked.parse(annualReportElement.textContent, { renderer: renderer });
                }

                // 情绪分析
                const sentimentElement = document.querySelector('#sentiment-analysis .md-content');
                if (sentimentElement && sentimentElement.textContent.trim()) {
                    sentimentElement.innerHTML = marked.parse(sentimentElement.textContent, { renderer: renderer });
                }
            }

            // 执行Markdown渲染
            renderMarkdown();

            // 为Markdown内容中的链接添加样式
            document.querySelectorAll('.md-content a').forEach(link => {
                link.classList.add('text-primary', 'hover:underline');
            });

            // 为Markdown内容中的标题添加样式
            document.querySelectorAll('.md-content h1, .md-content h2, .md-content h3').forEach(title => {
                title.classList.add('text-gray-800', 'mt-6', 'mb-3');
            });

            // 为Markdown内容中的列表添加样式
            document.querySelectorAll('.md-content ul, .md-content ol').forEach(list => {
                list.classList.add('ml-6', 'mb-4');
            });

            document.querySelectorAll('.md-content ul').forEach(ul => {
                ul.classList.add('list-disc');
            });

            document.querySelectorAll('.md-content ol').forEach(ol => {
                ol.classList.add('list-decimal');
            });

            // 为表格中的长文本添加处理
            document.querySelectorAll('.md-table td').forEach(cell => {
                // 允许长文本换行
                cell.style.wordBreak = 'break-word';
                // 确保有足够的内边距
                cell.style.padding = '0.75rem 1rem';
            });
        });
    </script>
</body>
</html>
